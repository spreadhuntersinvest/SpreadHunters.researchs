<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puuilo - Equity Research</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding-top: 40px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .data-status {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.95em;
            max-width: 600px;
            margin: 20px auto;
            text-align: center;
        }

        .data-status.loading {
            background: rgba(255, 165, 0, 0.2);
            border-left: 4px solid #ffa500;
        }

        .data-status.success {
            background: rgba(76, 175, 80, 0.2);
            border-left: 4px solid #4caf50;
        }

        .data-status.error {
            background: rgba(244, 67, 54, 0.2);
            border-left: 4px solid #f44336;
        }

        .kpi-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .kpi-card {
            background: linear-gradient(135deg, #f5f7ff 0%, #ffffff 100%);
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 8px;
        }

        .kpi-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .kpi-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #333;
        }

        .kpi-value.positive {
            color: #4ade80;
        }

        .kpi-value.negative {
            color: #ff6b6b;
        }

        .kpi-subtitle {
            font-size: 0.85em;
            color: #999;
            margin-top: 5px;
        }

        .content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .content h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .content p {
            line-height: 1.6;
            color: #666;
            margin-bottom: 15px;
        }

        footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            margin-top: 40px;
            font-size: 0.9em;
        }

        /* Datos ocultos para el index principal */
        [data-research-cache] {
            display: none;
        }

        .spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üè™ PUUILO OYJ</h1>
            <p>Equity Research - An√°lisis Fundamental</p>
            <div class="data-status loading" id="dataStatus">
                <span class="spinner"></span> Cargando datos del API...
            </div>
        </header>

        <!-- KPIs DIN√ÅMICOS -->
        <div class="kpi-section">
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-label">Ticker</div>
                    <div class="kpi-value" id="ticker">-</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Precio Actual (Cierre)</div>
                    <div class="kpi-value" id="currentPrice">-</div>
                    <div class="kpi-subtitle" id="priceDate">-</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Fair Value</div>
                    <div class="kpi-value" id="fairValue">‚Ç¨26,62</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Upside Potencial</div>
                    <div class="kpi-value" id="upside">-</div>
                    <div class="kpi-subtitle">vs. precio actual</div>
                </div>
            </div>
        </div>

        <!-- CONTENIDO DE AN√ÅLISIS -->
        <div class="content">
            <h2>üìä An√°lisis Fundamental</h2>
            <p><strong>Puuilo OYJ</strong> es una empresa finlandesa especializada en la venta de art√≠culos de hogar, ocio y decoraci√≥n. 
            Opera principalmente en Finlandia a trav√©s de tiendas f√≠sicas y canales de e-commerce.</p>
            
            <h3 style="margin-top: 25px; color: #333;">Tesis de Inversi√≥n</h3>
            <p>La empresa presenta una valuaci√≥n atractiva con potential upside significativo basado en el Fair Value estimado. 
            El an√°lisis fundamental sugiere una oportunidad de compra en la categor√≠a Long Value-Growth.</p>

            <h3 style="margin-top: 25px; color: #333;">Datos T√©cnicos</h3>
            <p>
                <strong>Bolsa:</strong> Helsinki (HE)<br>
                <strong>Sector:</strong> Retail - Home D√©cor & Hobby<br>
                <strong>Tipo de Inversi√≥n:</strong> Long Value-Growth<br>
                <strong>Nivel de Riesgo:</strong> Medio
            </p>

            <h3 style="margin-top: 25px; color: #333;">Nota Importante</h3>
            <p style="color: #999; font-size: 0.95em;">
                Los precios se actualizan con el cierre del d√≠a anterior para minimizar latencia en la carga. 
                √öltima actualizaci√≥n: <span id="lastUpdate">-</span>
            </p>
        </div>

        <footer>
            <p>¬© 2026 Investment Research. An√°lisis independiente.</p>
            <p>Datos obtenidos din√°micamente del API de precios (cach√© diario)</p>
        </footer>
    </div>

    <!-- CONTENEDOR DE DATOS PARA EL INDEX PRINCIPAL -->
    <div data-research-cache="puuilo"></div>

    <script>
        // ============================================
        // CONFIGURACI√ìN
        // ============================================
        const API_KEY = 'd5bt99pr01qsbmgh603gd5bt99pr01qsbmgh6040';
        const TICKER = 'PUUILO.HE';
        const FAIR_VALUE = 26.62; // En euros
        const CACHE_KEY = 'puuilo_price_cache';
        const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 horas en ms

        // ============================================
        // FUNCIONES PRINCIPALES
        // ============================================

        /**
         * Obtiene el precio actual del API o del cache
         */
        async function getPrice() {
            const statusEl = document.getElementById('dataStatus');
            
            // Primero, intentar obtener del cache
            const cached = getCachedPrice();
            if (cached) {
                displayPrice(cached, true);
                statusEl.innerHTML = '‚úì Usando datos en cach√© (cierre del d√≠a anterior)';
                statusEl.classList.remove('loading', 'error');
                statusEl.classList.add('success');
                return;
            }

            // Si no hay cache, obtener del API
            try {
                statusEl.innerHTML = '<span class="spinner"></span> Obteniendo precio del API...';
                statusEl.classList.add('loading');
                
                const response = await fetch(
                    `https://finnhub.io/api/v1/quote?symbol=${TICKER}&token=${API_KEY}`
                );
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                
                if (!data.c) {
                    throw new Error('No price data received');
                }

                const priceData = {
                    price: data.c,
                    timestamp: Date.now()
                };

                // Guardar en cache
                cachePriceData(priceData);
                displayPrice(priceData, false);
                
                statusEl.innerHTML = '‚úì Datos cargados correctamente';
                statusEl.classList.remove('loading', 'error');
                statusEl.classList.add('success');
                
            } catch (error) {
                console.error('Error al obtener precio:', error);
                
                statusEl.innerHTML = `‚ö†Ô∏è Error al cargar: ${error.message}. Usando datos de demostraci√≥n.`;
                statusEl.classList.remove('loading');
                statusEl.classList.add('error');
                
                // Datos de demostraci√≥n si falla el API
                displayPrice({ price: 12.52, timestamp: Date.now() }, false);
            }
        }

        /**
         * Obtiene el precio del cache local
         */
        function getCachedPrice() {
            try {
                const cached = localStorage.getItem(CACHE_KEY);
                if (!cached) return null;

                const data = JSON.parse(cached);
                const now = Date.now();

                // Verificar si est√° expirado
                if (now - data.timestamp > CACHE_DURATION) {
                    localStorage.removeItem(CACHE_KEY);
                    return null;
                }

                return data;
            } catch (e) {
                console.error('Error al leer cache:', e);
                return null;
            }
        }

        /**
         * Guarda el precio en cache local
         */
        function cachePriceData(data) {
            try {
                localStorage.setItem(CACHE_KEY, JSON.stringify(data));
            } catch (e) {
                console.error('Error al guardar cache:', e);
            }
        }

        /**
         * Muestra el precio en la p√°gina
         */
        function displayPrice(priceData, fromCache) {
            const price = priceData.price;
            const upside = ((FAIR_VALUE - price) / price * 100).toFixed(1);
            const upsideIsPositive = upside > 0;

            // Actualizar KPIs
            document.getElementById('ticker').textContent = TICKER;
            document.getElementById('currentPrice').textContent = `‚Ç¨${price.toFixed(2)}`;
            document.getElementById('fairValue').textContent = `‚Ç¨${FAIR_VALUE.toFixed(2)}`;
            
            const upsideEl = document.getElementById('upside');
            upsideEl.textContent = `${upside > 0 ? '+' : ''}${upside}%`;
            upsideEl.classList.toggle('positive', upsideIsPositive);
            upsideEl.classList.toggle('negative', !upsideIsPositive);

            // Fecha
            const date = new Date(priceData.timestamp);
            const dateStr = date.toLocaleDateString('es-ES', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('priceDate').textContent = `Cierre: ${dateStr}`;
            document.getElementById('lastUpdate').textContent = dateStr;

            // Guardar datos en localStorage para el index principal
            saveResearchData({
                ticker: TICKER,
                company: 'Puuilo',
                sector: 'Retail - Home D√©cor & Hobby',
                currentPrice: price,
                fairValue: FAIR_VALUE,
                upside: upside,
                riskLevel: 'Medio',
                date: dateStr,
                type: 'long-value-growth'
            });
        }

        /**
         * Guarda los datos de la investigaci√≥n en localStorage
         * para que el index principal pueda leerlos
         */
        function saveResearchData(data) {
            try {
                localStorage.setItem('research_puuilo', JSON.stringify(data));
                console.log('‚úì Datos guardados para index principal:', data);
            } catch (e) {
                console.error('Error al guardar datos:', e);
            }
        }

        // ============================================
        // INICIALIZAR AL CARGAR LA P√ÅGINA
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            getPrice();
        });

        // Opcional: Recargar cada 30 minutos
        // setInterval(getPrice, 30 * 60 * 1000);
    </script>
</body>
</html>
